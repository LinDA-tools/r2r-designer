(function(){"use strict";var a;a=angular.module("app",["ngCookies","ngResource","ngSanitize","ngRoute","ui.bootstrap","duScroll","underscore"]),a.config(["$routeProvider",function(a){return a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}])}).call(this),function(){"use strict";angular.module("app").factory("Config",function(){return{backend:"http://localhost:3000"}})}.call(this),function(){"use strict";angular.module("app").factory("Jsedn",function(){return jsedn})}.call(this),function(){"use strict";angular.module("app").factory("Rdb",["$http","_","Config",function(a,b,c){var d,e,f,g,h;return d=c.backend+"/api/v1/db",h=[],g={},f=[],e={},{datasource:{host:"localhost",driver:"org.postgresql.ds.PGSimpleDataSource",name:"mydb",username:"postgres",password:""},tables:function(){return h},tableColumns:function(){return g},selectedTables:function(){return f},selectedColumns:function(){return e},isSelectedTable:function(a){return b.contains(f,a)},isSelectedColumn:function(a,c){return b.contains(e[a],c)},toggleSelectTable:function(a){return b.contains(f,a)?f=b.without(f,a):f.push(a)},toggleSelectColumn:function(a,c){return null!=g[a]?b.contains(e[a],c)?e[a]=b.without(e[a],c):null!=e[a]?e[a].push(c):e[a]=[c]:void 0},checkDatabase:function(b){return a.post(d+"/test",{},{params:{driver:b.driver,host:b.host,name:b.name,username:b.username,password:b.password}})},registerDatabase:function(b){return a.post(d+"/register",{},{params:{driver:b.driver,host:b.host,name:b.name,username:b.username,password:b.password}})},getTables:function(){return a.get(d+"/tables").then(function(a){return h=a.data})},getTableColumns:function(){return a.get(d+"/table-columns").then(function(a){return g=a.data})},getColumn:function(b,c){return a.get(d+"/column",{params:{table:b,name:c}})}}}])}.call(this),function(){"use strict";angular.module("app").factory("Rdf",function(){return{baseUri:"",subjectTemplate:"",propertyLiteralSelection:{},propertyLiteralTypes:{},selectedClasses:{},selectedProperties:{},suggestions:{}}})}.call(this),function(){"use strict";angular.module("underscore",[]).factory("_",function(){return window._})}.call(this),function(){"use strict";angular.module("app").factory("Oracle",["$http","_","Config",function(a,b,c){var d,e;return d=c.backend+"/api/v1/oracle",e=function(a,c){return b.map(a,function(a){return{name:a,tag:c[a]||a}})},{ask:function(b,c,f,g){return null!=b&&null!=f?a.post(d,{table:{name:b,tag:c||b},columns:e(f,g)}).then(function(a){return a.data}):void 0}}}])}.call(this),function(){"use strict";angular.module("app").factory("Sml",["_",function(a){var b,c,d,e,f,g,h,i;return e=function(){return{index:0,table:{}}},c=function(a,b){var c,d;return c=b.table[a],c?c:(d="?x"+b.index++,b.table[a]=d,d)},h=function(b,c){var d,e;return e=function(){var a,e,f,g;for(f=b.classes[c],g=[],a=0,e=f.length;e>a;a++)d=f[a],g.push("a "+d.prefixedName[0]);return g}(),a.isEmpty(e)?"\n":a.foldl(e,function(a,b){return(a+";\n").concat(b)})},i=function(b,d,e){var f,g,h;return g=a.keys(b.properties[d]),h=function(){var a,h,i;for(i=[],a=0,h=g.length;h>a;a++)f=g[a],i.push(b.properties[d][f].prefixedName[0]+" "+c(f,e));return i}(),a.isEmpty(h)?"\n":a.foldl(h,function(a,b){return(a+";\n").concat(b)})},b=function(a){return"?"+a.substring(1,a.length-1)},g=function(c,d){var e;return a.isEmpty(c.subjectTemplate)?a.isEmpty(c.baseUri)?"?s = uri(tns:"+d+")\n":"?s = bNode(concat('"+d+"', '_')\n":(e=c.subjectTemplate,e=e.replace(/{[^}]*}/g,function(a){return";$;"+b(a)+";$;"}),e=e.split(";$;"),e=a.filter(e,function(b){return!a.isEmpty(b)}),e=a.map(e,function(a){return"?"===a[0]?a:"'"+a+"'"}),e="concat('"+c.baseUri+"', "+e+")",a.isEmpty(c.baseUri)?"?s = bNode("+e+")":"?s = uri("+e+")")},f=function(b,d,e){var f,g,h,i;return g=b.literals,i=b.literalTypes,f=a.keys(b.properties[d]),f=a.filter(f,function(a){var c;return c=b.properties[d][a].prefixedName[0],g[c]||"Typed Literal"===litearls[c]&&i[c]}),h=a.map(f,function(a){var f;switch(f=b.properties[d][a].prefixedName[0],g[f]){case"Blank Node":return e[f]=c(a,e)+" = bNode(?"+a+")";case"Plain Literal":return e[f]=c(a,e)+" = plainLiteral(?"+a+")";case"Typed Literal":return e[f]=c(a,e)+" = typedLiteral(?"+a+", "+i[f]+")";default:return""}}),a.isEmpty(h)?"":a.foldl(h,function(a,b){return(a+"\n").concat(b)})},d=function(b){var c,d,e;return c=["Prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>","Prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>","Prefix xsd: <http://www.w3.org/2001/XMLSchema#>"],e=a.flatten(a.values(b.classes).concat(a.map(a.values(b.properties),a.values))),d=a.without(a.map(e,function(b){return null!=b["vocabulary.prefix"]&&null!=b["vocabulary.uri"]?"Prefix "+a.first(b["vocabulary.prefix"])+": <"+a.first(b["vocabulary.uri"])+">":null}),null),a.foldl(c.concat(d),function(a,b){return(a+"\n").concat(b)})},{toSml:function(a){var b,c;return c="products",b=e(),""+d(a)+"\nPrefix tns: <"+a.baseUri+">\n\nCreate View "+c+" As\n    Construct {\n        ?s \n"+h(a,c)+";\n"+i(a,c,b)+".\n    }\n    With\n"+g(a,c)+"\n"+f(a,c,b)+"\n    From "+c}}}])}.call(this),function(){"use strict";angular.module("app").factory("Transform",["$http","_",function(a){var b,c;return b="http://localhost:3000",c=b+"/api/v1/transform",{getDumpUrl:function(b){return null!=b?a.post(c,{mapping:b}).then(function(a){return c+a.data}):void 0},getMappingUrl:function(b){return null!=b?a.post(c+"/mapping",{mapping:b}).then(function(a){return c+a.data}):void 0},publish:function(b){return null!=b?a.post(c,{mapping:b}).then(function(a){return a.data}):void 0}}}])}.call(this),function(){"use strict";var a;a=angular.module("app"),a.directive("wizard",function(){return{restrict:"EA",transclude:!0,templateUrl:"partials/wizard.html",controller:["$scope","$document","$timeout",function(a,b,c){a.steps=[],a.$on("changeSidetip",function(b,d){return c(function(){return a.sidetip.tmpl=d})}),this.addStep=function(b){return a.steps.push(b),1===a.steps.length?this.goTo(b.name):void 0},this.getStep=function(b){var c;return function(){var d,e,f,g;for(f=a.steps,g=[],d=0,e=f.length;e>d;d++)c=f[d],c.name===b&&g.push(c);return g}()[0]},this.goTo=function(b){var d;return d=this.getStep,c(function(){var c;return c=d(b),null!=c&&null!=a.currentStep&&(a.currentStep.selected=!1,a.currentStep.treated=!0),c.selected=!0,a.currentStep=c,a.sidetip.tooltip=a.currentStep.description})},this.fnStep=function(b,c){var d,e,f;return f=this.getStep(b),d=a.steps.indexOf(f),e=c(d),-1!==d&&e>=0&&e<a.steps.length&&null!=a.steps[e]&&this.goTo(a.steps[e].name),a.steps[e].name},this.nextStep=function(a){return this.fnStep(a,function(a){return++a})},this.prevStep=function(a){return this.fnStep(a,function(a){return--a})},this.isFirst=function(b){return a.steps[0].name===b},this.isLast=function(b){return a.steps[a.steps.length-1].name===b},this.scrollTo=function(a,c,d){var e;return e=angular.element(document.getElementById(a)),b.scrollTo(e,c||30,d||750)}}]}}),a.directive("step",function(){return{restrict:"E",require:"^wizard",scope:{name:"@",heading:"@",description:"@",sidetip:"="},transclude:!0,templateUrl:"partials/step.html",link:function(a,b,c,d){return d.addStep({name:a.name,heading:a.heading,description:a.description,selected:a.selected}),a.isSelected=function(){return d.getStep(a.name).selected},a.isTreated=function(){return d.getStep(a.name).treated},a.isFirst=function(){return d.isFirst(a.name)},a.isLast=function(){return d.isLast(a.name)}}}}),a.directive("next",function(){return{restrict:"A",require:"^wizard",link:function(a,b,c,d){return b.bind("click",function(){var b;return b=d.nextStep(a.name),d.scrollTo(b)})}}}),a.directive("prev",function(){return{restrict:"A",require:"^wizard",link:function(a,b,c,d){return b.bind("click",function(){var b;return b=d.prevStep(a.name),d.scrollTo(b)})}}}),a.directive("goto",function(){return{restrict:"A",require:"^wizard",link:function(a,b,c,d){return b.bind("click",function(){return d.goTo(c.goto),d.scrollTo(c.goto)})}}})}.call(this),function(){"use strict";var a;a=angular.module("app"),a.directive("popover",function(){return{restrict:"A",link:function(a,b,c){return $(b).popover({trigger:"hover",html:!0,content:c.popoverHtml,placement:c.popoverPlacement})}}})}.call(this),function(){"use strict";var a;a=angular.module("app"),a.directive("columntip",function(){return{restrict:"A",scope:{table:"@",column:"@"},controller:["$scope","Rdb",function(a,b){return a.rdb=b,a.getData=function(){return a.rdb.getColumn(a.table,a.column)}}],link:function(a,b){return b.bind("mouseenter",function(){return a.getData().success(function(b){var c;return c=_.foldl(_.take(b,20),function(a,b){return(a+"<br />").concat(b)}),_.size(b)>20&&(c+="<br />..."),a.$emit("changeSidetip",c)})}),b.bind("mouseleave",function(){return a.$emit("changeSidetip","")})}}})}.call(this),function(){"use strict";var a;a=angular.module("app"),a.directive("cursor",function(){return{restrict:"A",scope:{content:"=",cursorpos:"="},controller:["$scope",function(){}],link:function(a,b){return b.on("keyup",function(){return a.cursorpos=b.prop("selectionStart"),a.$apply()}),b.on("click",function(){return a.cursorpos=b.prop("selectionStart"),a.$apply()})}}})}.call(this),function(){"use strict";var a;a=angular.module("app"),a.directive("rdfBadge",["$timeout",function(){return{restrict:"A",replace:!0,scope:{uri:"@",label:"@",local:"@",prefixed:"@",definition:"@",vocabUri:"@",vocabTitle:"@",vocabDescr:"@",score:"@"},templateUrl:"partials/rdfbadge.html",controller:["$scope",function(a){var b,c,d;return b=a.definition&&!_.isEmpty(a.definition)?'<span style="margin-left:1em">\n  '+a.definition+"\n</span>\n<hr />":'<span style="margin-left:1em;font-style:italic;color:#dddddd">\n  No definition available!\n</span>\n<hr />',c=null==a.vocabDescr||_.isEmpty(a.vocabDescr)?"":'<span style="margin-left:1em">\n  '+a.vocabDescr+"\n</span>",d=null==a.vocabTitle||_.isEmpty(a.vocabTitle)?'<h5>\n  <sup>2</sup>&rarr;&nbsp;<a href="'+a.vocabUri+'">'+a.vocabUri+"</a>\n</h5>\n"+c+"\n<hr />":"<h4>\n  <sup>2</sup>"+a.vocabTitle+'\n</h4>\n<span>\n  &rarr;&nbsp;<a href="'+a.vocabUri+'">'+a.vocabUri+'</a>\n</span><br /><br />\n<span style="margin-left:1em">\n  '+a.vocabDescr+"\n</span>\n<hr />",a.tmpl="<h4><sup>1</sup>"+(a.label||a.local)+'</h4>\n<span>&rarr;&nbsp;<a href="'+a.uri+'">'+a.uri+"</a></span><br /><br />\n"+b+"\n"+d+'\n<span class="score">score: '+a.score+"</span>"}],link:function(a,b){return b.bind("mouseenter",function(){return a.$emit("changeSidetip",a.tmpl)}),b.bind("mouseleave",function(){return a.$emit("changeSidetip","")})}}}])}.call(this),function(){"use strict";angular.module("app").controller("MainCtrl",["$scope","_",function(a){return a.sidetip={tooltip:"",tmpl:""}}])}.call(this),function(){"use strict";angular.module("app").controller("ConfigCtrl",["$scope","Rdb",function(a,b){return a.rdb=b,a.checking=!1,a.checked=!1,a.success=!1,a.$watch("rdb.datasource.host",function(){return a.checked=!1}),a.$watch("rdb.datasource.driver",function(){return a.checked=!1}),a.$watch("rdb.datasource.name",function(){return a.checked=!1}),a.$watch("rdb.datasource.username",function(){return a.checked=!1}),a.$watch("rdb.datasource.password",function(){return a.checked=!1}),a.test=function(){return a.checking=!0,a.rdb.checkDatabase(a.rdb.datasource).success(function(b){return a.checking=!1,a.checked=!0,a.success="true"===b}).error(function(b){return a.checking=!1,a.checked=!0,a.success="false"===b})},a.apply=function(){return a.checked=!1,a.rdb.registerDatabase(a.rdb.datasource).then(function(){return a.rdb.getTables(),a.rdb.getTableColumns()})}}])}.call(this),function(){"use strict";angular.module("app").controller("DbContentsCtrl",["$scope","Rdb",function(a,b){return a.rdb=b}])}.call(this),function(){"use strict";angular.module("app").controller("ReconcileCtrl",["$scope","_","Oracle","Rdb","Rdf",function(a,b,c,d,e){return a.rdb=d,a.rdf=e,a.loading=!1,a.table="",a.tableTag={},a.columns=[],a.columnTags={},a.$watch("rdb.selectedTables()",function(c){return null!=c?a.table=b.first(a.rdb.selectedTables()):void 0}),a.$watch("table",function(b){return null!=b?a.columns=a.rdb.selectedColumns()[b]:void 0}),a.ask=function(b,d){return a.loading=!0,c.ask(b,a.tableTag[b],d,a.columnTags).then(function(c){return a.loading=!1,a.rdf.suggestions[b]=c})},a.getColumnSuggestions=function(c,d){return null!=a.rdf.suggestions&&a.rdf.suggestions[c]&&null!=a.rdf.suggestions[c].columns?b.first(b.filter(a.rdf.suggestions[c].columns,function(a){return a.name===d})).recommend:void 0},a.selectClass=function(c,d){var e;return null!=c&&null!=d?b.contains(a.rdf.selectedClasses[c],d)?a.rdf.selectedClasses[c]=b.without(a.rdf.selectedClasses[c],d):(e=a.rdf.selectedClasses[c]||[],e.push(d),a.rdf.selectedClasses[c]=e):void 0},a.selectProperty=function(b,c,d){var e;return null!=b&&null!=c&&null!=d?(e=a.rdf.selectedProperties[b]||{},e[c]=e[c]===d?null:d,a.rdf.selectedProperties[b]=e):void 0},a.isSelectedClass=function(c,d){return b.contains(a.rdf.selectedClasses[c],d)},a.isSelectedProperty=function(b,c,d){var e;return e=a.rdf.selectedProperties[b],e&&e[c]===d}}])}.call(this),function(){"use strict";angular.module("app").controller("RefineCtrl",["$scope","_","Rdb","Rdf",function(a,b,c,d){return a.rdb=c,a.rdf=d,a.table="",a.columns=[],a.selectedColumns=[],a.cursorpos=0,a.propertyLiteralTypeOptions=["Plain Literal","Typed Literal","Blank Node"],a.propertyLiteralTypes=["xsd:anyURI","xsd:base64Binary","xsd:boolean","xsd:date","xsd:dateTime","xsd:decimal","xsd:double","xsd:duration","xsd:float","xsd:hexBinary","xsd:gDay","xsd:gMonth","xsd:gMonthDay","xsd:gYear","xsd:gYearMonth","xsd:NOTATION","xsd:QName","xsd:string","xsd:time"],a.$watch("rdb.selectedTables()",function(c){return null!=c?a.table=b.first(a.rdb.selectedTables()):void 0}),a.$watch("table",function(b){return null!=b?a.columns=a.rdb.selectedColumns()[b]:void 0}),a.isSelected=function(c){return b.contains(a.selectedColumns,c)},a.insert=function(c){var d;return a.isSelected(c)?(d=a.rdf.subjectTemplate,a.rdf.subjectTemplate=d.replace("{"+c+"}",""),a.selectedColumns=b.without(a.selectedColumns,c)):(d=a.rdf.subjectTemplate,a.rdf.subjectTemplate=d.slice(0,a.cursorpos)+"{"+c+"}"+d.slice(a.cursorpos,d.length),a.selectedColumns.push(c))}}])}.call(this),function(){"use strict";angular.module("app").controller("PublishCtrl",["$scope","$timeout","$window","_","Rdb","Rdf","Sml","Transform",function(a,b,c,d,e,f,g,h){return a.rdb=e,a.rdf=f,a.sml=g,a.transform=h,a.publishing=!1,a.success=!1,a.dump=function(){var b,d;return b={tables:a.rdb.selectedTables(),columns:a.rdb.selectedColumns(),baseUri:a.rdf.baseUri,subjectTemplate:a.rdf.subjectTemplate,classes:a.rdf.selectedClasses,properties:a.rdf.selectedProperties,literals:a.rdf.propertyLiteralSelection,literalTypes:a.rdf.propertyLiteralTypes},d=c.open(""),a.currentMapping=a.sml.toSml(b),a.transform.getDumpUrl(a.currentMapping).then(function(a){return d.location=a})},a.mapping=function(){var b,d;return b={tables:a.rdb.selectedTables(),columns:a.rdb.selectedColumns(),baseUri:a.rdf.baseUri,subjectTemplate:a.rdf.subjectTemplate,classes:a.rdf.selectedClasses,properties:a.rdf.selectedProperties,literals:a.rdf.propertyLiteralSelection,literalTypes:a.rdf.propertyLiteralTypes},a.currentMapping=a.sml.toSml(b),d=c.open(""),d.document.open(),d.document.write("<pre>"+a.currentMapping+"</pre>"),d.document.close()},a.publish=function(){var b;return a.publishing=!0,b={tables:a.rdb.selectedTables(),columns:a.rdb.selectedColumns(),baseUri:a.rdf.baseUri,subjectTemplate:a.rdf.subjectTemplate,classes:a.rdf.selectedClasses,properties:a.rdf.selectedProperties,literals:a.rdf.propertyLiteralSelection,literalTypes:a.rdf.propertyLiteralTypes},a.publishing=!1,a.success=!0,a.currentMapping=a.sml.toSml(b)}}])}.call(this),function(){"use strict";angular.module("app").filter("scoreFilter",function(){return function(a){return Number(a).toPrecision(2)}})}.call(this);